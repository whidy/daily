<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="//gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.54.0" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title> &middot; Daily note</title>

  
  <link type="text/css" rel="stylesheet" href="https://daily.whidy.netcss/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://daily.whidy.netcss/poole.css">
  <link type="text/css" rel="stylesheet" href="https://daily.whidy.netcss/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://daily.whidy.netcss/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  <link href="" rel="alternate" type="application/rss+xml" title="Daily note" />

  
</head>

  <body class=" ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://daily.whidy.net"><h1>Daily note</h1></a>
      <p class="lead">
      An elegant open source and mobile first theme for <a href="http://hugo.spf13.com">hugo</a> made by <a href="http://twitter.com/mdo">@mdo</a>. Originally made for Jekyll.
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="https://daily.whidy.net">Home</a> </li>
        
      </ul>
    </nav>

    <p>&copy; 2019. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1></h1>
  <time datetime=0001-01-01T00:00:00Z class="post-date">Mon, Jan 1, 0001</time>
  

<h1 id="ä½¿ç”¨elementuiå’Œaxiosä»¥formdataæ ¼å¼æäº¤å¸¦æœ‰æ–‡ä»¶çš„è¡¨å•çš„é”™è¯¯ç¤ºèŒƒåŠåˆ†æè§£å†³">ä½¿ç”¨ElementUIå’ŒAxiosä»¥formDataæ ¼å¼æäº¤å¸¦æœ‰æ–‡ä»¶çš„è¡¨å•çš„é”™è¯¯ç¤ºèŒƒåŠåˆ†æè§£å†³</h1>

<blockquote>
<p>åšVueé¡¹ç›®çš„æ—¶å€™, æäº¤æ•°æ®åŸºæœ¬ä¸Šéƒ½æ˜¯ç”¨Axios, ä¹‹å‰åšè¿‡çš„è¡¨å•æ–¹é¢çš„æäº¤, å¹¶æ²¡æœ‰è¿‡å¤šå…³æ³¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡è¿‡ç¨‹. æ‰€ä»¥ä¸€ç›´å¯¹HTTPçš„headè¯·æ±‚å¤´, bodyå†…å®¹ä¹‹ç±»çš„ä¸æ˜ä¸ç™½, ä¸ºäº†çŸ­æœŸ(æ˜¯çš„ä¼°è®¡è¿‡åŠå¹´åˆå¿˜äº†ğŸ˜‚)è§£å†³è¿™ä¸ªç–‘æƒ‘, å†æ¬¡å¤ä¹ äº†ä¸€é. é¡ºä¾¿æ€»ç»“äº†<strong>Vueä¸­ä½¿ç”¨Axioså¤„ç†åŒ…å«ä¸Šä¼ æ–‡ä»¶çš„è¡¨å•æäº¤</strong></p>
</blockquote>

<h2 id="åœºæ™¯è¯´æ˜">åœºæ™¯è¯´æ˜</h2>

<p>é¡¹ç›®ä½¿ç”¨çš„Vue(Nuxt)æ¡†æ¶, æ•°æ®è¯·æ±‚ç”¨çš„<a href="https://github.com/axios/axios">Axios</a>æ’ä»¶, è¡¨å•åŒ…å«äº†ä¸€äº›åŸºæœ¬çš„ç”¨æˆ·ä¿¡æ¯å¡«å†™, åŒæ—¶è¿˜æœ‰èº«ä»½è¯ä¸Šä¼ , å’Œåç«¯æ²Ÿé€šè¿‡, æäº¤æ•°æ®çš„æ—¶å€™, æ¥å£å…¨éƒ¨ä½¿ç”¨<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/POST">POST</a>è¯·æ±‚, é‚£ä¹ˆæœ‰æ–‡ä»¶ä¸Šä¼ çš„ä¸€èˆ¬æ¥è¯´åªèƒ½ç”¨formDataæ ¼å¼.</p>

<h2 id="å®è·µåŠä»£ç ç¤ºä¾‹">å®è·µåŠä»£ç ç¤ºä¾‹</h2>

<p>æˆ‘é¡¹ç›®ä¸­ä½¿ç”¨çš„æ˜¯ElementUI, å¯¹äº<a href="http://element.eleme.io/#/zh-CN/component/upload#upload-shang-chuan">ä¸Šä¼ ç»„ä»¶</a>ä¸ç†Ÿæ‚‰çš„æœ‹å‹, éœ€è¦æ³¨æ„å‡ ä¸ªäº‹æƒ…:</p>

<ul>
<li>actionæ˜¯å¿…å¡«, é‚£ä¹ˆç•™ç©ºä¹Ÿè®¸æ˜¯ä¸ªä¸é”™çš„åšæ³•.</li>
<li>è·å–åˆ°ä¸Šä¼ çš„æ–‡ä»¶çš„åŠæ³•å¾ˆå¤š. å®˜æ–¹æä¾›äº†å‡ ç§äº‹ä»¶æ¥è·å–, ä¾‹å¦‚: <code>on-success</code>, <code>on-change</code>(é¦–æ¬¡ä¸Šä¼ ä¼šè§¦å‘ä¸¤æ¬¡), æˆ‘è¿™é‡Œä½¿ç”¨äº†<code>on-success</code></li>

<li><p>é‚£ä¹ˆæ‹¿åˆ°ä¸Šä¼ çš„å›è°ƒ, è¿™é‡Œç‰¹åˆ«éœ€è¦æ³¨æ„çš„, æˆ‘ä»¥<code>on-success</code>ä¸‰ä¸ªå‚æ•°æ¥çœ‹</p>

<ul>
<li><code>response</code>æ˜¯æœåŠ¡å™¨è¿”å›çš„å“åº”</li>
<li><code>file</code>ä¸€ä¸ªæ–‡ä»¶</li>
<li><code>fileList</code>å­˜æ”¾å¤šä¸ªæ–‡ä»¶çš„æ•°ç»„</li>
</ul>

<blockquote>
<p>å¯èƒ½çœ‹åˆ°æœ‰<code>file</code>æˆ–è€…<code>fileList</code>ä¼šç›´æ¥å°†å®ƒçš„æ•°æ®æäº¤ç»™åå°, ä¸€å¼€å§‹æˆ‘ä¹Ÿæ˜¯æ²¡æ³¨æ„åˆ°è¿™ç‚¹, å§‹ç»ˆæ— æ³•æ­£ç¡®æäº¤æ•°æ®. é‚£ä¹ˆç»è¿‡ä¸€ç•ªç ”ç©¶å’Œæ’æŸ¥, å¾—çŸ¥: <strong>çœŸæ­£çš„Fileå¯¹è±¡æ˜¯<code>fileList</code>æ•°ç»„ä¸­æŸä¸ªå…ƒç´ çš„<code>raw</code>å±æ€§!</strong>, é‚£ä¹ˆä¸‹é¢å…ˆçœ‹ä¸€æ®µé”™è¯¯çš„ç¤ºèŒƒ:</p>
</blockquote></li>
</ul>

<p>é¡µé¢éƒ¨åˆ†ç»“æ„ä»£ç å¦‚ä¸‹:</p>

<pre><code class="language-html">&lt;el-form ref=&quot;form&quot; :model=&quot;form&quot; label-width=&quot;120px&quot;&gt;
  &lt;el-form-item label=&quot;æ´»åŠ¨åç§°&quot;&gt;
    &lt;el-input v-model=&quot;form.name&quot;&gt;&lt;/el-input&gt;
  &lt;/el-form-item&gt;
  &lt;el-form-item label=&quot;æ´»åŠ¨åŒºåŸŸ&quot;&gt;
    &lt;el-select v-model=&quot;form.region&quot; placeholder=&quot;è¯·é€‰æ‹©æ´»åŠ¨åŒºåŸŸ&quot;&gt;
      &lt;el-option label=&quot;åŒºåŸŸä¸€&quot; value=&quot;shanghai&quot;&gt;&lt;/el-option&gt;
      &lt;el-option label=&quot;åŒºåŸŸäºŒ&quot; value=&quot;beijing&quot;&gt;&lt;/el-option&gt;
    &lt;/el-select&gt;
  &lt;/el-form-item&gt;
  &lt;el-form-item label=&quot;èº«ä»½è¯æ­£é¢&quot;&gt;
    &lt;el-upload 
      action=&quot;&quot; 
      :on-success	=&quot;handleSuccess&quot;
      :multiple=&quot;false&quot; 
      :limit=&quot;1&quot; 
      :on-exceed=&quot;handleExceed&quot; 
      :file-list=&quot;fileList&quot;&gt;
      &lt;el-button size=&quot;small&quot; type=&quot;primary&quot;&gt;ç‚¹å‡»ä¸Šä¼ &lt;/el-button&gt;
      &lt;div slot=&quot;tip&quot; class=&quot;el-upload__tip&quot;&gt;åªèƒ½ä¸Šä¼ jpg/pngæ–‡ä»¶ï¼Œä¸”ä¸è¶…è¿‡500kb&lt;/div&gt;
    &lt;/el-upload&gt;
  &lt;/el-form-item&gt;
  &lt;el-form-item&gt;
    &lt;el-button type=&quot;primary&quot; @click=&quot;onSubmit&quot;&gt;æäº¤&lt;/el-button&gt;
    &lt;el-button&gt;å–æ¶ˆ&lt;/el-button&gt;
  &lt;/el-form-item&gt;
&lt;/el-form&gt;
</code></pre>

<p>è¿™é‡Œæˆ‘å°†ä¸Šä¼ æ–‡ä»¶æ•°é‡é™åˆ¶ä¸º<code>1</code>ä¸ª, æ¥ä¸‹æ¥æ˜¯JavaScriptéƒ¨åˆ†:</p>

<pre><code class="language-javascript">import AppLogo from '~/components/AppLogo.vue'
export default {
  components: {
    AppLogo
  },
  data() {
    return {
      form: {
        name: '',
        region: ''
      },
      fileList: []
    }
  },
  methods: {
    handleSuccess(response, file, fileList) {
      this.fileList = fileList
    },
    handleExceed(files, fileList) {
      this.$message.warning(`æœ€å¤šä¸Šä¼  ${files.length} ä¸ªæ–‡ä»¶`)
    },
    onSubmit() {
      this.$axios
        .$post('/api/active', {
          name: this.form.name,
          region: this.form.region,
          file: this.fileList
        })
        .then(response =&gt; {
          if (response.code === 200) {
            // æäº¤æˆåŠŸå°†è¦æ‰§è¡Œçš„ä»£ç 
          }
        })
        .catch(function(error) {
          // console.log(error)
        })
    }
  }
}
</code></pre>

<blockquote>
<p>ä¸Šé¢çš„è¿™æ®µ<code>onSubmit</code>èƒ½æäº¤æˆåŠŸå°±æ˜¯çœŸçš„è§äº†é¬¼å‘¢</p>
</blockquote>

<h3 id="é—®é¢˜åˆ†æ">é—®é¢˜åˆ†æ</h3>

<p>é—®é¢˜åœ¨å“ªå‘¢, å‰é¢æåˆ°, åå°æ¥å—æ•°æ®çš„æ ¼å¼æ˜¯<code>multipart/form-data</code>, ä½ å‘ä¸ªjsonå¯¹è±¡æ˜¯ä»€ä¹ˆé¬¼, æ²¡æœ‰è¿™æ–¹é¢ç»éªŒçš„äººè‚¯å®šå°±æä¸æ¸…æ€ä¹ˆå›äº‹äº†. æ‰€ä»¥ä¸€èˆ¬å¯¹è¿™å—ä¸ç†Ÿæ‚‰çš„äººå®¹æ˜“çŠ¯ä»¥ä¸‹çš„å‡ ä¸ªé”™è¯¯:</p>

<ul>
<li>ä¸äº†è§£ä¸Šä¼ æ–‡ä»¶åº”è¯¥ä»¥ä»€ä¹ˆæ–¹å¼æäº¤, æ¯”å¦‚åå°æ˜¯<code>multipart/form-data</code>, è€Œä¹ æƒ¯æ€§ä»¥jsonå¯¹è±¡å‘é€æ•°æ®(å› ä¸ºå¤§é‡æ’ä»¶å¯¹æ•°æ®å¯¹è±¡ä¹Ÿå°è£…äº†æ–¹æ³•, æ‰€ä»¥å®¹æ˜“å¿½ç•¥)</li>
<li>ä¸çŸ¥é“ä¸Šä¼ æ–‡ä»¶æäº¤çš„æ ¼å¼, ä»¥ä¸ºå°†<code>this.fileList</code>æ”¹æˆ<code>this.fileList[0]</code>å°±ä¸‡äº‹å¤§å‰</li>
<li>å½“å¤šç§ç–‘æƒ‘æ— æ³•è§£å†³çš„æ—¶å€™, å¯èƒ½ä¼šå°è¯•å¾ˆå¤šæ¬¡éƒ½ä¸è¡Œ, é™·å…¥è¯¯åŒºè€Œä¹…ä¹…æ— æ³•è§£å†³å›°éš¾. å¼€å§‹æ€€ç–‘æ˜¯å¦æ˜¯Axiosæ’ä»¶ä¸æ”¯æŒæ–‡ä»¶ä¸Šä¼ .</li>
<li>å…¶ä»–å„ç§åˆ«çš„é—®é¢˜&hellip;</li>
</ul>

<h3 id="é—®é¢˜è§£å†³">é—®é¢˜è§£å†³</h3>

<p>å…¶å®, ç†Ÿæ‚‰çš„è¯, è§£å†³è¿™ä¸ªé—®é¢˜å¾ˆç®€å•. å‰é¢ä¹Ÿè¯´è¿‡, elementUIå°†è¿”å›çš„<code>file</code>å¯¹è±¡å°è£…äº†ä¸€ä¸‹, é¦–å…ˆæˆ‘ä»¬è¦æ‹¿åˆ°çœŸæ­£çš„æ–‡ä»¶å¯¹è±¡, å®é™…ä¸Šå°±æ˜¯<code>file.raw</code>æˆ–è€…<code>fileList[0].raw</code>!</p>

<p>ä¸è¦ä»¥ä¸ºè¿™æ ·å°±å¯ä»¥æäº¤æ•°æ®äº†. æˆ‘ä»¬è¿˜è¦ä½¿ç”¨<code>form-data</code>ç‰¹æœ‰çš„æäº¤æ–¹å¼æ¥æäº¤å¸¦æœ‰æ–‡ä»¶å†…å®¹çš„è¡¨å•. åºŸè¯ä¸å¤šè¯´ä¸Šä¸€æ®µ, ä¿®æ­£åçš„éƒ¨åˆ†ä»£ç :</p>

<pre><code class="language-html">&lt;el-upload 
  action=&quot;&quot; 
  :http-request=&quot;handleFile&quot; 
  :multiple=&quot;false&quot; 
  :limit=&quot;1&quot; 
  :on-exceed=&quot;handleExceed&quot; 
  :file-list=&quot;fileList&quot;&gt;
  &lt;el-button size=&quot;small&quot; type=&quot;primary&quot;&gt;ç‚¹å‡»ä¸Šä¼ &lt;/el-button&gt;
  &lt;div slot=&quot;tip&quot; class=&quot;el-upload__tip&quot;&gt;åªèƒ½ä¸Šä¼ jpg/pngæ–‡ä»¶ï¼Œä¸”ä¸è¶…è¿‡500kb&lt;/div&gt;
&lt;/el-upload&gt;
</code></pre>

<pre><code class="language-javascript">onSubmit() {
  let form = this.$refs['form'].$el
  let formData = new FormData(form)
  formData.append('name', this.form.name)
  formData.append('region', this.form.region)
  formData.append('file', this.fileList[0])
  this.$axios
    .$post('/api/active', formData)
    .then(response =&gt; {
      if (response.code === 200) {
        // æäº¤æˆåŠŸå°†è¦æ‰§è¡Œçš„ä»£ç 
      }
    })
    .catch(function(error) {
      // console.log(error)
    })
}
</code></pre>

<p>ç®€å•è¯´æ˜ä¸‹</p>

<ul>
<li>å…¶å®elementUIä¸­æä¾›äº†ä¸€ä¸ª<code>http-request</code>äº‹ä»¶æ¥è¦†ç›–é»˜è®¤çš„action, è¿™æ ·å¾ˆå¥½çš„é¿å…äº†ä¸€äº›å¼‚å¸¸(æ¯”å¦‚æˆ‘åœ¨æµ‹è¯•ç¯å¢ƒçš„æ—¶å€™, ç”¨äº†ä¸å¤ªå¥½çš„çš„<code>on-success</code>é€šè¿‡äº†éªŒè¯, ä½†æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç”±äºactionåœ°å€ç©ºæ‰€ä»¥é»˜è®¤è¯·æ±‚å½“å‰åœ°å€, å‡ºç°äº†404).</li>
<li>formDataä¼¼ä¹åªèƒ½ä¸€ä¸ªä¸ªå¯¹åº”çš„appendè¿›å», consoleå‡ºæ¥ä¹Ÿçœ‹ä¸åˆ°, å…·ä½“ç”¨æ³•å¯ä»¥å‚è€ƒæ–‡ç« æœ«å°¾çš„MDN~</li>
<li>axiosæ˜¯å¯ä»¥å¾ˆå¥½åœ°å®ŒæˆformDataè¡¨å•æ•°æ®æäº¤çš„, è¿™é‡Œè™½ç„¶ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡, ä½†æ˜¯ä¸æ˜¯æ™®é€šçš„jsonå¯¹è±¡, ä»–å¯¹è¿™ä¸ªæ•°æ®å¤„ç†å¾ˆæ­£å¸¸, æ‰€ä»¥æ”¾å¿ƒä½¿ç”¨.</li>
</ul>

<h2 id="é¢å¤–è¡¥å……-axiosé…ç½®">é¢å¤–è¡¥å……: axiosé…ç½®</h2>

<blockquote>
<p>Axioså¯ä»¥è¯´åœ¨Vueä¸­ç›¸å½“é‡è¦, ç»å¸¸æˆ‘ä»¬å¯¹ç®€å•çš„é‡æ–°å°è£…æˆ–è€…é…ç½®, å°±è¿™ä¸ªæ’ä»¶æ¥è¯´å®Œå…¨å¯ä»¥å†™ä¸€ç¯‡æ–°æ–‡ç« äº†, è¿™é‡Œä»–ä¸æ˜¯é‡ç‚¹æˆ‘å°±ç®€å•ä»‹ç»ä¸‹æˆ‘ç”¨å®ƒåšçš„é…ç½®</p>
</blockquote>

<pre><code class="language-javascript">import qs from 'qs'
import { Message } from 'element-ui'
export default function({ $axios, redirect }) {
  let apiUrl = process.env.apiUrl
  $axios.defaults.baseURL = apiUrl
  $axios.defaults.timeout = 15000
  $axios.defaults.headers.post['Content-Type'] = 'multipart/form-data'
  $axios.onRequest(config =&gt; {
    // ä¸åå°é…åˆpostè¯·æ±‚å­—ç¬¦ä¸²ä¼ å‚
    let reqParams = qs.stringify(config.data)
    let url = config.url + (reqParams ? '?' : '') + reqParams
    config.url = url
  })

  $axios.onResponse(res =&gt; {
    if (res.data.code !== 200) {
      // åå°è¿”å›sessionè¿‡æœŸæˆ–å¼‚å¸¸çš„æƒ…å†µ
      if (res.data.code === 401 || res.config.url === apiUrl + '/logout') {
        window.sessionStorage.clear()
        redirect('/platform/login')
      } else {
        // è¿”å›åˆ°ä¸€ä¸ªé”™è¯¯é¡µé¢æˆ–è€…æç¤ºé”™è¯¯
        Message.error(res.data.message)
        // redirect('/')
      }
    }
  })

  $axios.onError(error =&gt; {
    Message.error('æœåŠ¡å™¨å¼‚å¸¸ï¼Œè¯·ç¨åå†è¯•')
  })
}
</code></pre>

<p>ä¸Šé¢å¯¹å‘é€æ•°æ®è¯·æ±‚çš„ç›¸å…³å‚æ•°é…ç½®äº†, ä¹Ÿåšäº†æ‹¦æˆªå™¨. <code>qs</code>æ’ä»¶æ˜¯ä¸ªäº®ç‚¹, æˆ‘ä¸ºäº†vueä»£ç ä¹¦å†™æ›´æ¸…æ™°, å°†<code>json</code>å¯¹è±¡ä¼ è¿‡æ¥å¤„ç†ä¸º<code>name=whidy&amp;age=30</code>ç±»ä¼¼è¿™æ ·çš„æ‹¼æ¥åˆ°urlåå†å‘é€è¯·æ±‚ç»™æœåŠ¡å™¨çš„.</p>

<h2 id="æ€»ç»“">æ€»ç»“</h2>

<p>å¥½äº†è¯´äº†ä¸€å¤§å †, å…¶å®æœ€é‡è¦çš„äº‹æƒ…æ˜¯, ç†è§£ä»¥ä¸‹å‡ ç‚¹</p>

<ul>
<li>å’Œåç«¯æ²Ÿé€šå¥½, è¯·æ±‚æ ¼å¼</li>
<li>äº†è§£ä¸Šä¼ æ–‡ä»¶éœ€è¦çš„è¡¨å•æ•°æ®æ ¼å¼</li>
<li>å°½é‡å¤šçš„å»ç†Ÿæ‚‰ç¬¬ä¸‰æ–¹UIæ’ä»¶, å°¤å…¶åƒelementUIè¿™æ ·ç›¸å¯¹å®Œå–„çš„ç»„ä»¶, åº”è¯¥æ˜¯æœ‰è¾ƒå¥½çš„å¤„ç†æ–¹æ³•çš„</li>
<li>è€å¿ƒçš„ä¸€æ­¥æ­¥æŸ¥æ‰¾é”™è¯¯</li>
</ul>

<p>æœ€åçŒ®ä¸Šä¸€äº›å‚è€ƒèµ„æ–™:</p>

<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FormData">MDNçš„FormDataä»‹ç»</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FormData/Using_FormData_Objects">MDNçš„ä½¿ç”¨FormDataæ•°æ®</a></li>
<li><a href="https://github.com/axios/axios/issues/318#issuecomment-218948420">å¯¹æˆ‘å¸®åŠ©å¾ˆå¤§çš„æ¥è‡ªAxiosçš„Issue</a></li>
</ul>

<p>æ–‡ä¸­éš¾å…ä¹Ÿæœ‰ä¸€äº›æè¿°ä¸å‡†ç¡®çš„åœ°æ–¹, å¸Œæœ›å¤§ä½¬ä»¬å¤šå¤šæŒ‡ç‚¹~ æœ¬æ–‡æåˆ°çš„ä»£ç çš„å­˜æ”¾åœ¨GitHubä¸Šé¢<strong>nuxt-spa-demo</strong>é¡¹ç›®çš„åˆ†æ”¯<a href="https://github.com/whidy/nuxt-spa-demo/tree/nuxt-axios-formdata">nuxt-axios-formdata</a>, æœ‰å…´è¶£ä¹Ÿå¯ä»¥çœ‹çœ‹~</p>

</div>


    </main>

    
  </body>
</html>
