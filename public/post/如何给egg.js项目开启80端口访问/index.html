<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>如何给Egg.js项目开启80端口访问 :: Whidy Daily — Here is Whidy&#39;s github note, you will find somethings here.</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="如何给Egg.js项目开启80端口访问 为什么要 因某些特殊情况，项目cdn做了防盗链，然后本地开发也收到了限制，在cdn设置了一些本地ip的白名单，居然对端口支持不好，结果有时候可以访问cdn资源，有时候又不行，无奈，和运维、后端商量讲开发地址暂时改成80端口，以便正常开发~
 Egg.js的项目改端口很简单啦。但是也有一些要注意的，本文面向MacOS，当然Linux系统应该同样适用。
 如何做 这里有几个方案，供君参考：
修改package.json 跑哪个命令就在这个命令后面加--port=80，例如：
&amp;quot;start&amp;quot;: &amp;quot;egg-scripts start --daemon --title=egg-server-51la-web-egg --workers=2 --port=80&amp;quot;, ...  dev同理。
配置config.local.js 如果没有这个文件自己创建一个，当然这个对应的是开发模式下使用。
部分配置如下：
&#39;use strict&#39;; module.exports = app =&amp;gt; { const exports = {}; exports.cluster = { listen: { port: 80, hostname: &#39;127.0.0.1&#39;, }, }; return exports; };  Nginx大法 比较麻烦，不过看了下官方文档，应该也是可以很好的支持的。有兴趣请阅读该节：
 部署  Warning 如果你不看这部分，很遗憾，你肯定跑不起来。你可能会遇到下面这些异常情况：
ERROR 3810 nodejs.AppWorkerDiedError: [master] app_worker#1:3813 died (code: 0, signal: null, suicide: false, state: dead), current workers: []  原因是Node."/>
<meta name="keywords" content="whidy daily blog"/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/post/%E5%A6%82%E4%BD%95%E7%BB%99egg.js%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%90%AF80%E7%AB%AF%E5%8F%A3%E8%AE%BF%E9%97%AE/" />


<link rel="stylesheet" href="/assets/style.css">



<link rel="stylesheet" href="/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">

<link rel="shortcut icon" href="/img/favicon/orange.png">



<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="如何给Egg.js项目开启80端口访问 :: Whidy Daily — Here is Whidy&#39;s github note, you will find somethings here." />
<meta name="twitter:description" content="如何给Egg.js项目开启80端口访问 为什么要 因某些特殊情况，项目cdn做了防盗链，然后本地开发也收到了限制，在cdn设置了一些本地ip的白名单，居然对端口支持不好，结果有时候可以访问cdn资源，有时候又不行，无奈，和运维、后端商量讲开发地址暂时改成80端口，以便正常开发~
 Egg.js的项目改端口很简单啦。但是也有一些要注意的，本文面向MacOS，当然Linux系统应该同样适用。
 如何做 这里有几个方案，供君参考：
修改package.json 跑哪个命令就在这个命令后面加--port=80，例如：
&amp;quot;start&amp;quot;: &amp;quot;egg-scripts start --daemon --title=egg-server-51la-web-egg --workers=2 --port=80&amp;quot;, ...  dev同理。
配置config.local.js 如果没有这个文件自己创建一个，当然这个对应的是开发模式下使用。
部分配置如下：
&#39;use strict&#39;; module.exports = app =&amp;gt; { const exports = {}; exports.cluster = { listen: { port: 80, hostname: &#39;127.0.0.1&#39;, }, }; return exports; };  Nginx大法 比较麻烦，不过看了下官方文档，应该也是可以很好的支持的。有兴趣请阅读该节：
 部署  Warning 如果你不看这部分，很遗憾，你肯定跑不起来。你可能会遇到下面这些异常情况：
ERROR 3810 nodejs.AppWorkerDiedError: [master] app_worker#1:3813 died (code: 0, signal: null, suicide: false, state: dead), current workers: []  原因是Node." />
<meta name="twitter:site" content="/" />
<meta name="twitter:creator" content="whidy" />
<meta name="twitter:image" content="">


<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="如何给Egg.js项目开启80端口访问 :: Whidy Daily — Here is Whidy&#39;s github note, you will find somethings here.">
<meta property="og:description" content="如何给Egg.js项目开启80端口访问 为什么要 因某些特殊情况，项目cdn做了防盗链，然后本地开发也收到了限制，在cdn设置了一些本地ip的白名单，居然对端口支持不好，结果有时候可以访问cdn资源，有时候又不行，无奈，和运维、后端商量讲开发地址暂时改成80端口，以便正常开发~
 Egg.js的项目改端口很简单啦。但是也有一些要注意的，本文面向MacOS，当然Linux系统应该同样适用。
 如何做 这里有几个方案，供君参考：
修改package.json 跑哪个命令就在这个命令后面加--port=80，例如：
&amp;quot;start&amp;quot;: &amp;quot;egg-scripts start --daemon --title=egg-server-51la-web-egg --workers=2 --port=80&amp;quot;, ...  dev同理。
配置config.local.js 如果没有这个文件自己创建一个，当然这个对应的是开发模式下使用。
部分配置如下：
&#39;use strict&#39;; module.exports = app =&amp;gt; { const exports = {}; exports.cluster = { listen: { port: 80, hostname: &#39;127.0.0.1&#39;, }, }; return exports; };  Nginx大法 比较麻烦，不过看了下官方文档，应该也是可以很好的支持的。有兴趣请阅读该节：
 部署  Warning 如果你不看这部分，很遗憾，你肯定跑不起来。你可能会遇到下面这些异常情况：
ERROR 3810 nodejs.AppWorkerDiedError: [master] app_worker#1:3813 died (code: 0, signal: null, suicide: false, state: dead), current workers: []  原因是Node." />
<meta property="og:url" content="/post/%E5%A6%82%E4%BD%95%E7%BB%99egg.js%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%90%AF80%E7%AB%AF%E5%8F%A3%E8%AE%BF%E9%97%AE/" />
<meta property="og:site_name" content="如何给Egg.js项目开启80端口访问" />
<meta property="og:image" content="">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2019-03-15 00:00:00 &#43;0000 UTC" />











</head>
<body class="">


<div class="container">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    Daily Note
  </div>
</a>

    </div>
    <div class="menu-trigger">menu</div>
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/daily">Daily</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/daily">Daily</a></li>
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
  <div class="post">
    <h1 class="post-title"><a href="/post/%E5%A6%82%E4%BD%95%E7%BB%99egg.js%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%90%AF80%E7%AB%AF%E5%8F%A3%E8%AE%BF%E9%97%AE/">如何给Egg.js项目开启80端口访问</a></h1>
    <div class="post-meta">
      <span class="post-date">
        2019-03-15
      </span>
      <span class="post-author">:: whidy</span>
    </div>

    

    

    <div class="post-content">
      

<h1 id="如何给egg-js项目开启80端口访问">如何给Egg.js项目开启80端口访问</h1>

<h2 id="为什么要">为什么要</h2>

<p>因某些特殊情况，项目cdn做了防盗链，然后本地开发也收到了限制，在cdn设置了一些本地ip的白名单，居然对端口支持不好，结果有时候可以访问cdn资源，有时候又不行，无奈，和运维、后端商量讲开发地址暂时改成<code>80</code>端口，以便正常开发~</p>

<blockquote>
<p>Egg.js的项目改端口很简单啦。但是也有一些要注意的，本文面向<code>MacOS</code>，当然<code>Linux</code>系统应该同样适用。</p>
</blockquote>

<h2 id="如何做">如何做</h2>

<p>这里有几个方案，供君参考：</p>

<h3 id="修改package-json">修改package.json</h3>

<p>跑哪个命令就在这个命令后面加<code>--port=80</code>，例如：</p>

<pre><code>&quot;start&quot;: &quot;egg-scripts start --daemon --title=egg-server-51la-web-egg --workers=2 --port=80&quot;,
...
</code></pre>

<p>dev同理。</p>

<h3 id="配置config-local-js">配置config.local.js</h3>

<p>如果没有这个文件自己创建一个，当然这个对应的是开发模式下使用。</p>

<p>部分配置如下：</p>

<pre><code>'use strict';
module.exports = app =&gt; {
  const exports = {};
  exports.cluster = {
    listen: {
      port: 80,
      hostname: '127.0.0.1',
    },
  };
  return exports;
};
</code></pre>

<h3 id="nginx大法">Nginx大法</h3>

<p>比较麻烦，不过看了下官方文档，应该也是可以很好的支持的。有兴趣请阅读该节：</p>

<ul>
<li><a href="https://eggjs.org/zh-cn/tutorials/socketio.html#%E9%83%A8%E7%BD%B2">部署</a></li>
</ul>

<h2 id="warning">Warning</h2>

<p>如果你不看这部分，很遗憾，你肯定跑不起来。你可能会遇到下面这些异常情况：</p>

<pre><code>ERROR 3810 nodejs.AppWorkerDiedError: [master] app_worker#1:3813 died (code: 0, signal: null, suicide: false, state: dead), current workers: []
</code></pre>

<p>原因是Node.js的服务器端默认是无法使用1024以下的端口的。咋办呢？使用<code>sudo</code>哈哈哈。就是这样：<code>sudo npm start</code>或者<code>sodu npm run dev</code>。</p>

<p>也有可能是：</p>

<pre><code>ERROR 3709 [app_worker] server got error: bind EADDRINUSE null:80, code: EADDRINUSE
</code></pre>

<p>端口被占用了！node.js的server服务无法在ctrl+c后立刻终止。比如默认7001未能正常关闭，通过<code>config.local.js
</code>文件修改的80端口也没有能够生效，每次启动服务都是启动了新的端口<code>7002</code>，此时：需要查出占用<code>7001</code>的端口的<code>pid</code>，将它终止。操作效果大致如下：</p>

<pre><code>P750TM:51la-web-egg whidy$ lsof -i:7001
COMMAND  PID  USER   FD   TYPE             DEVICE SIZE/OFF NODE NAME
node    2982 whidy   25u  IPv6 0x2f7a1da313a05e4d      0t0  TCP *:afs3-callback (LISTEN)
P750TM:51la-web-egg whidy$ kill
kill: usage: kill [-s sigspec | -n signum | -sigspec] pid | jobspec ... or kill -l [sigspec]
P750TM:51la-web-egg whidy$ kill 2982
P750TM:51la-web-egg whidy$ lsof -i:7001
</code></pre>

<p>上面用到两个命令：<code>lsof -i:[端口号]</code>，<code>kill [进程的PID]</code>，最后重新查询7001就没有任何返回，说明Ok了，再次执行<code>sudo npm run dev</code>，那么就很好的使用80端口了。</p>

<h2 id="参考">参考</h2>

<ul>
<li><a href="https://eggjs.org/zh-cn/core/deployment.html#%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4">egg.js启动命令</a></li>
<li><a href="https://stackoverflow.com/questions/9164915/node-js-eacces-error-when-listening-on-most-ports">Node.js EACCES error when listening on most ports</a></li>
</ul>

<p>本文仅作为总结形式，未能重新完整的实践整个流程，如果有操作跳跃性或错误欢迎提出~</p>

    </div>
    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">查看其他</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
          
            <span class="button next">
              <a href="/post/w350etqk590s%E9%BB%91%E8%8B%B9%E6%9E%9C10.13/">
                <span class="button__text">Clevo W350ETQ(神舟K590S)安装黑苹果10.13总结</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
    

    

  </div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2019 Powered by <a href="http://gohugo.io">Hugo</a></span>
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>





  
</div>

</body>
</html>
