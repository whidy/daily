<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="//gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.54.0" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>安装Gatsby和Strapi过程中的各种问题 &middot; Daily note</title>

  
  <link type="text/css" rel="stylesheet" href="https://daily.whidy.netcss/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://daily.whidy.netcss/poole.css">
  <link type="text/css" rel="stylesheet" href="https://daily.whidy.netcss/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://daily.whidy.netcss/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  <link href="" rel="alternate" type="application/rss+xml" title="Daily note" />

  
</head>

  <body class=" ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://daily.whidy.net"><h1>Daily note</h1></a>
      <p class="lead">
      An elegant open source and mobile first theme for <a href="http://hugo.spf13.com">hugo</a> made by <a href="http://twitter.com/mdo">@mdo</a>. Originally made for Jekyll.
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="https://daily.whidy.net">Home</a> </li>
        
      </ul>
    </nav>

    <p>&copy; 2019. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>安装Gatsby和Strapi过程中的各种问题</h1>
  <time datetime=2018-01-24T00:00:00Z class="post-date">Wed, Jan 24, 2018</time>
  

<blockquote>
<p>2018年1月24日 阴 一般</p>
</blockquote>

<h1 id="安装gatsby和strapi">安装Gatsby和Strapi</h1>

<h2 id="vps上安装gatsby和strapi中遇到的各种问题解决方案和相关记录">VPS上安装Gatsby和Strapi中遇到的各种问题解决方案和相关记录</h2>

<blockquote>
<p>参考<a href="https://hackernoon.com/building-a-static-blog-using-gatsby-and-strapi-8b5acfc82ad8">Building a static blog using Gatsby and Strapi</a></p>
</blockquote>

<h3 id="安装gatsby">安装Gatsby</h3>

<blockquote>
<p>事情总是不是那么顺利.</p>
</blockquote>

<p>根据Gatsby文档<a href="https://www.gatsbyjs.org/docs/">Get started</a>, 执行到如下命令时:</p>

<pre><code class="language-bash"># gatsby new gatsby-site
</code></pre>

<p>报错, 需要<code>git</code>. 然而我的服务器没装, 那就装一个吧. 参考<a href="https://git-scm.com/download/linux">Download for Linux and Unix</a>执行:</p>

<pre><code class="language-bash"># yum install git
</code></pre>

<p>再次执行后依旧报错(当前git版本<code>1.7.1</code>)</p>

<pre><code class="language-bash">error Command failed: git clone git://github.com/gatsbyjs/gatsby-starter-default.git gatsby-site --single-branch
</code></pre>

<p>推测是版本问题. 只好手动安装了. 于是又找到这个<a href="https://git-scm.com/book/zh/v1/%E8%B5%B7%E6%AD%A5-%E5%AE%89%E8%A3%85-Git">安装 Git</a></p>

<pre><code class="language-bash"># yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel
# wget https://www.kernel.org/pub/software/scm/git/git-2.16.1.tar.gz
# tar -zxf git-2.16.1.tar.gz
# cd git-2.16.1
# make prefix=/usr/local all
# sudo make prefix=/usr/local install
</code></pre>

<p>漫长的<code>make prefix=/usr/local all</code>之后, 提示:</p>

<pre><code class="language-bash">    SUBDIR perl
/usr/bin/perl Makefile.PL PREFIX=\'/usr/local\' INSTALL_BASE=\'\' --localedir=\'/usr/local/share/locale\'
Can\'t locate ExtUtils/MakeMaker.pm in @INC (@INC contains: /usr/local/lib64/perl5 /usr/local/share/perl5 /usr/lib64/perl5/vendor_perl /usr/share/perl5/vendor_perl /usr/lib64/perl5 /usr/share/perl5 .) at Makefile.PL line 3.
BEGIN failed--compilation aborted at Makefile.PL line 3.
make[1]: *** [perl.mak] Error 2
make: *** [perl/perl.mak] Error 2
</code></pre>

<p>蛋疼, 等了半天, 又要解决这个问题, 好在看起来比较容易处理, 参考<a href="https://github.com/qsnake/qsnake/issues/12">git fails to build in Fedora 14</a>, 然后继续执行最后两条<code>make</code>命令, 虽然最后出来很多看起来很奇怪的内容, 不过似乎是成功了. 执行:</p>

<pre><code class="language-bash"># git --version
git version 2.16.1
</code></pre>

<p>接下来我们再一次执行<code>gatsby new gatsby-site</code>, 我擦还提示刚才的<code>...single-branch</code>的error, 这就坑爹了- -. 经过简短的排查. 原来似乎他还是跑的旧版git, 需要删掉之前yum自动安装的<code>git 1.7.1</code>, 我单纯的以为直接自动升级了. 于是:</p>

<pre><code class="language-bash"># yum remove git
</code></pre>

<p>按照提示删除成功后, 再次检测git还是ok的, 这次我第三次执行<code>gatsby new gatsby-site</code>, 终于成功了! 我这小白也不知道linux软件管理是咋整的. 反正能继续执行卡了我半天的gatsby就好了吧&hellip;</p>

<p>剩下的依照接下来的文档操作就好了, 很快就看到了Gatsby主页了~ &ldquo;Hi people&rdquo;!</p>

<blockquote>
<p>此时几乎耗费了一上午的时间了, 嘘&hellip; 期待能通过尝试学习到react, graphQL等相关的内容</p>
</blockquote>

<h3 id="安装strapi">安装Strapi</h3>

<blockquote>
<p>Requirements: please make sure <strong>Node 8</strong> (or higher) and <strong>MongoDB</strong> are installed and running on your machine.</p>
</blockquote>

<p>此时, 暗喜前阵子已经琢磨出来了并装好了<code>Node 8</code>, 不过装MongoDB就没有了. 果断找到文档<a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat/">Install MongoDB Community Edition on Red Hat Enterprise or CentOS Linux</a>, 这个redhat和centOS应该是通用的吧- -! 看到<a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat/#configure-the-package-management-system-yum">Configure the package management system (yum).</a>, 发现原来还有这种操作, 创建repo文件, 来安装对应版本的软件. 闲话少说, 按步骤很快就装好了. 此时需要启动mongod再继续安装Strapi, 如下命令:</p>

<pre><code class="language-bash"># service mongod start
</code></pre>

<p>到了这个步骤的时候</p>

<pre><code class="language-bash"># strapi start
</code></pre>

<p>卡住了, 频繁报错如下</p>

<pre><code class="language-bash">[root@whidy api]# strapi start
DEBUG (24910 on whidy): Server wasn't able to start properly.
ERROR (24910 on whidy): (hook:mongoose) takes too long to load
</code></pre>

<p>大概是网络原因, 我联通网络出问题, 换了电信几番尝试就好了, 创建了admin账户后, 进入后台继续按步骤操作.</p>

<blockquote>
<p>操作过程中频繁出现刚才的问题, 我觉得不是网络问题那么简单, 我打算从数据库方面着手完善一下试试</p>
</blockquote>

<pre><code class="language-bash"># mango
&gt; use admin
&gt; db.createUser(
    {
      user: &quot;username&quot;,
      pwd: &quot;userpassword&quot;,
      roles: [ { role: &quot;userAdminAnyDatabase&quot;, db: &quot;admin&quot; } ]
    }
  )
# mongo --port 27017 -u &quot;username&quot; -p &quot;userpassword&quot; --authenticationDatabase &quot;admin&quot;
</code></pre>

</div>


    </main>

    
  </body>
</html>
