---
layout: post
title: "Nginx的站点配置"
date: 2018-03-22
categories: wordpress nginx
---
> 2018年3月22日 晴 一般

# Nginx的站点配置

> 昨晚, 回去看了一下百度统计, 一下子就炸了.


关于Server Block配置存放

> To begin, we will need to set up the directory that our server blocks will be stored in, as well as the directory that tells Nginx that a server block is ready to serve to visitors. The `sites-available` directory will keep all of our server block files, while the `sites-enabled` directory will hold symbolic links to server blocks that we want to publish. 

https://www.digitalocean.com/community/tutorials/how-to-set-up-nginx-server-blocks-on-centos-7




关于Nginx语法:

http://blog.51cto.com/denglz/1341841

关于网站跳转:

https://www.digitalocean.com/community/tutorials/how-to-create-temporary-and-permanent-redirects-with-nginx

关于配置二级域名



Nginx配置参考

https://gist.github.com/MaherSaif/1580998

wordpress nginx 配置参考
GithubGist https://gist.github.com/kjprince/9496501
https://codex.wordpress.org/Nginx
https://www.nginx.com/resources/wiki/start/topics/recipes/wordpress/

Server Block Examples

https://www.nginx.com/resources/wiki/start/topics/examples/server_blocks/



上次弄apache出现过安装插件提示:

这次又出现了"要执行请求的操作，WordPress需要访问您网页服务器的权限。"- -知道是权限问题,却不知道是哪个权限..突然想起nginx的php管理是php-fpm...

chown -R php-fpm:php-fpm /var/www/wordpress

就好了..



理解 Linux 的硬链接与软链接
https://www.ibm.com/developerworks/cn/linux/l-cn-hardandsymb-links/index.html







首先我创建了一个`Jekyll`站点, 它生成的静态目录在`/home/whidy/blog/_site`的时候. 而`nginx`管理网站的目录是`/var/www/`, 我这里为了方便管理创建了软连接, 如下

```bash
# ln -s /home/whidy/blog/_site /var/www/blog
```

配置了`server block`, 如下

```txt
server {
    listen 80;
    server_name test.whidy.net;
    root /var/www/blog;
    index index.html index.htm;

    location / {
    }

    error_page 404 /404.html;
        location = /40x.html {
    }

    error_page 500 502 503 504 /50x.html;
        location = /50x.html {
    }
}
```

然后访问网站出现`403`, 查了很多资料, 不确定是否跟软链接有关, 后来查出来了, 因为我当前运行nginx的用户是`nginx`(命令查看: `ps -ef | grep nginx`), 那么**nginx没有权限访问用户whidy的目录及文件**, 本以为给`_site`目录设置可读就行了, 然后还是`403`, 为此折腾了很久, 才查到原来同时还**需要给nginx一个可读whidy目录的权限**! 也就是说此时必须同时给`/home/whidy/blog/_site`(包含_site内的所有文件)和`/home/whidy`目录可读权限才能正常访问

```bash
# chmod +r -R /home/whidy/blog/_site
# chmod +r /home/whidy
```

无需重启Nginx服务, 刷新页面然后就好了.

> 很奇怪的是, 我假设给blog目录不设置全部可读, 它照样正常. 真是蛋疼~