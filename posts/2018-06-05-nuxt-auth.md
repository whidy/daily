---
layout: post
title: "Nuxt在SPA模式下的鉴权处理"
date: 2018-06-05
categories: nuxt localstorage sessionstorage cookie
---
> 2018年6月5日 阴雨 一般

> 最近项目使用了Nuxt, 不过由于考虑到项目需要快速上线, 放弃了SSR, 直接采用单页面SPA模式进行开发, 也是本人第一次使用Nuxt来进行项目开发, 以下是我开发中对于**鉴权这块的研究和总结**, 因为官方给了一个[鉴权示例](https://zh.nuxtjs.org/examples/auth-routes/)是基于Server端的, 所以我就又写了一篇Client端的鉴权总结~

## 预备知识

* [Vue](https://cn.vuejs.org/v2/guide/)和[Vuex](https://vuex.vuejs.org/zh/)
* [Document.cookie](https://developer.mozilla.org/zh-CN/docs/Web/API/Document/cookie)
* [HTTP 的基本性质](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Overview#HTTP_%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%80%A7%E8%B4%A8)
* [Window.localStorage](https://developer.mozilla.org/zh-CN/docs/Web/API/Window/localStorage)和[Window.sessionStorage](https://developer.mozilla.org/zh-CN/docs/Web/API/Window/sessionStorage)

## 介绍

**Nuxt.js 是一个基于 Vue.js 的通用应用框架。**那么既然是基于Vue的, 它自然也就用到的**Vuex**, 自然会遇到一个问题, 它本是**状态管理模式**, 不过有时候我们会作为数据共享的一种解决方案, 但是它会在页面刷新时丢失.

因此在Vue项目开发中, 我们每次刷新获取数据可能只有两种方式:

1. 每次刷新都会向服务器发送请求, 拿到数据后, 对页面重新更新视图
1. 每次操作都会存在本客户端的Cookie或者Storage中

很显然一般情况下, 第一种方法会给服务器资源造成浪费, 除非需要获取的数据是频繁变化的, 那么我们一般会使用第二种. 下面就主要针对第二个方案进行总结.

## 需求分析

我们都知道HTTP是无状态的, 那么为了让用户每次访问页面的时候会话能够保持, 则需要用cookie或者storage来记录. 我们后台的session有效期为半小时.

在这半小时内, 用户处于登录状态, 本地也保存了有效凭证的情况下, 则该用户的有效资源请求可以被执行, 而无需服务器每次进行验证~ (如果这里存在疑问可以尝试阅读预备知识中提到的**HTTP**)

那么需求方希望本地存储的凭证会在会话关闭后清除, 因此我们首先排除`localStorage`, 考虑使用`Cookie`和`sessionStorage`! 又因为本人比较懒, Cookie操作不够娴熟, 所以决定使用`sessionStorage`.(虽然最后还使用了插件...)

## 

https://stackoverflow.com/questions/44126493/i-want-to-use-window-localstorage-in-vuex-in-nuxt-js
https://github.com/championswimmer/vuex-persist

cookie
https://medium.com/@eddybordi/nuxt-js-ssr-authentication-8a6afba26533


https://github.com/watchout-tw/watchout-common-functions/issues/9




https://github.com/nuxt/nuxt.js/blob/937ce612c76d9642b2a617cbf1e2420fe3540992/examples/with-cookies/nuxt.config.js